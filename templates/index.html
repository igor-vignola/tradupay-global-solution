<!DOCTYPE html>
<html lang="pt-br" class="dark">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TraduPay | Inteligência Contábil</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class', 
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['-apple-system', 'BlinkMacSystemFont', '"Segoe UI"', 'Roboto', 'Helvetica', 'Arial', 'sans-serif'],
                    },
                },
            },
        }
    </script>
    
    <style>
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in { animation: fade-in 0.5s ease-out forwards; }

        /* Remove setas de input[type=number] */
        input[type=number] { appearance: textfield; -moz-appearance: textfield; }
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
          -webkit-appearance: none; margin: 0; 
        }

        /* Força o dropdown nativo a ser escuro */
        select {
            color-scheme: dark; 
        }
        
        /* Estiliza opções internas (Chrome/Edge) */
        option {
            background-color: #111827; /* gray-900 */
            color: #e5e7eb; /* gray-200 */
            padding: 12px;
        }
    </style>
</head>

<body class="min-h-screen bg-gray-900 text-gray-200 flex flex-col font-sans antialiased">
        
    <header class="sticky top-0 z-50 w-full border-b border-gray-800 bg-gray-900/90 backdrop-blur-xl shadow-lg transition-all duration-300">
        
        <div class="absolute top-0 left-0 w-full h-[1px] bg-gradient-to-r from-transparent via-teal-500/60 to-transparent"></div>

        <div class="container mx-auto px-4 h-24 flex items-center justify-center">
            
            <div class="flex items-center gap-4 group cursor-default">
                
                <div class="relative flex items-center justify-center w-14 h-14 bg-gray-800 rounded-2xl border border-gray-700 shadow-xl group-hover:border-teal-500/40 transition-all duration-300 group-hover:shadow-[0_0_15px_rgba(20,184,166,0.15)]">
                    <div class="absolute inset-0 bg-teal-400/10 rounded-2xl blur-sm opacity-0 group-hover:opacity-100 transition-opacity"></div>
                    
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-teal-400 relative z-10 transform group-hover:scale-110 transition-transform duration-300">
                        <path d="M16 16.5a2.5 2.5 0 0 0-5 0"></path><path d="M12 14v7"></path><path d="M4 16.5a2.5 2.5 0 0 0 5 0"></path><path d="M12 2v7"></path><path d="M7 7l-5 5"></path><path d="m17 7 5 5"></path><path d="M2 12h20"></path>
                    </svg>
                </div>
                
                <div class="flex flex-col justify-center">
                    <h1 class="text-3xl font-black text-white tracking-tighter leading-none group-hover:text-gray-100 transition-colors">
                        Tradu<span class="text-teal-400">Pay</span>
                    </h1>
                    <p class="text-xs font-bold text-gray-500 uppercase tracking-[0.2em] mt-1 group-hover:text-teal-500/70 transition-colors">
                        Inteligência Contábil
                    </p>
                </div>
            </div>

        </div>
    </header>

    <main class="flex-grow container mx-auto px-4 py-8 flex flex-col items-center">
        <div class="w-full max-w-4xl">
            
            <form action="" method="POST">
                {% csrf_token %}
                
                <div id="benchmark-form" class="relative bg-gray-900/80 border border-gray-800 p-8 rounded-2xl mb-12 animate-fade-in overflow-hidden group">
    
                    <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-teal-500/0 via-teal-500/50 to-teal-500/0 opacity-50 group-hover:opacity-100 transition-opacity duration-500"></div>

                    <div class="flex flex-col md:flex-row items-center justify-between mb-8 gap-4">
                        <div class="flex items-center gap-4">
                            <div class="flex items-center justify-center w-12 h-12 rounded-xl bg-teal-900/20 border border-teal-500/30 text-teal-400 shadow-[0_0_15px_rgba(20,184,166,0.1)]">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                            </div>
                            <div>
                                <h2 class="text-xl font-bold text-white tracking-wide">Contexto Profissional</h2>
                                <p class="text-sm text-gray-400">Calibre a análise para sua realidade de mercado.</p>
                            </div>
                        </div>
                        
                        <div class="hidden md:block px-3 py-1 rounded-full bg-gray-800 border border-gray-700 text-xs text-gray-500 uppercase tracking-widest font-semibold">
                            Dados Anônimos
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="relative group/input">
                            <label for="area" class="block text-xs font-medium text-teal-500/80 uppercase tracking-wider mb-2 ml-1 group-hover/input:text-teal-400 transition-colors">Área de Atuação</label>
                            <div class="relative">
                                <select id="area" name="area" class="w-full appearance-none bg-gray-800 text-gray-200 border border-gray-700 rounded-xl py-3.5 pl-4 pr-10 focus:outline-none focus:ring-2 focus:ring-teal-500/50 focus:border-teal-500 transition-all cursor-pointer hover:bg-gray-750">
                                    <option value="">Selecione a área...</option>
                                    {% for area in areas_list %}
                                        <option value="{{ area }}" {% if area == selected_area %}selected{% endif %}>{{ area }}</option>
                                    {% endfor %}
                                </select>
                                <div class="absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none text-gray-500 group-hover/input:text-teal-400 transition-colors">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
                                </div>
                            </div>
                        </div>

                        <div class="relative group/input">
                            <label for="seniority" class="block text-xs font-medium text-teal-500/80 uppercase tracking-wider mb-2 ml-1 group-hover/input:text-teal-400 transition-colors">Nível de Experiência</label>
                            <div class="relative">
                                <select id="seniority" name="seniority" class="w-full appearance-none bg-gray-800 text-gray-200 border border-gray-700 rounded-xl py-3.5 pl-4 pr-10 focus:outline-none focus:ring-2 focus:ring-teal-500/50 focus:border-teal-500 transition-all cursor-pointer hover:bg-gray-750">
                                    <option value="">Selecione o nível...</option>
                                    {% for level in seniorities_list %}
                                        <option value="{{ level }}" {% if level == selected_seniority %}selected{% endif %}>{{ level }}</option>
                                    {% endfor %}
                                </select>
                                <div class="absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none text-gray-500 group-hover/input:text-teal-400 transition-colors">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
                                </div>
                            </div>
                        </div>

                        <div class="relative group/input">
                            <label for="location" class="block text-xs font-medium text-teal-500/80 uppercase tracking-wider mb-2 ml-1 group-hover/input:text-teal-400 transition-colors">Localização</label>
                            <div class="relative">
                                <select id="location" name="location" class="w-full appearance-none bg-gray-800 text-gray-200 border border-gray-700 rounded-xl py-3.5 pl-4 pr-10 focus:outline-none focus:ring-2 focus:ring-teal-500/50 focus:border-teal-500 transition-all cursor-pointer hover:bg-gray-750">
                                    <option value="">Selecione o local...</option>
                                    {% for loc in locations_list %}
                                        <option value="{{ loc }}" {% if loc == selected_location %}selected{% endif %}>{{ loc }}</option>
                                    {% endfor %}
                                </select>
                                <div class="absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none text-gray-500 group-hover/input:text-teal-400 transition-colors">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="values-form" class="transition-all duration-500 ease-in-out">
    
                    <div class="flex flex-col items-center mb-10">
                        <div class="bg-gray-900 p-1.5 rounded-xl flex space-x-1 border border-gray-700 shadow-2xl relative overflow-hidden">
                            <input type="hidden" name="work_mode" id="work_mode_input" value="{{ work_mode|default:'clt' }}">
                            
                            <button type="button" id="btn-clt" onclick="setWorkMode('clt')" class="relative z-10 px-8 py-3 rounded-lg text-sm font-bold transition-all duration-300 flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="35" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path></svg>
                                Sou CLT
                            </button>
                            
                            <button type="button" id="btn-pj" onclick="setWorkMode('pj')" class="relative z-10 px-8 py-3 rounded-lg text-sm font-bold transition-all duration-300 flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="35" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 7h-9"></path><path d="M14 17H5"></path><circle cx="17" cy="17" r="3"></circle><circle cx="7" cy="7" r="3"></circle></svg>
                                Sou PJ
                            </button>
                        </div>
                        <p class="text-xs text-gray-500 mt-2">Escolha sua situação atual para compararmos com a proposta.</p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8 relative">
                        
                        <div id="card-clt" class="group relative bg-gradient-to-b from-gray-800 to-gray-900 p-1 rounded-2xl transition-all duration-300 hover:shadow-blue-500/10 hover:shadow-2xl">
                            <div class="absolute inset-0 bg-gradient-to-br from-blue-500/20 to-transparent opacity-50 rounded-2xl group-hover:opacity-100 transition-opacity pointer-events-none"></div>
                            
                            <div class="relative h-full bg-gray-900/90 backdrop-blur-xl rounded-xl p-6 border border-blue-500/30 flex flex-col">
                                <div class="mb-6">
                                    <div class="flex items-center justify-between mb-2">
                                        <label class="text-blue-400 font-bold tracking-wide uppercase text-xs" id="h2-clt-label">CLT ATUAL</label>
                                        <div class="p-1.5 bg-blue-500/10 rounded-md text-blue-400">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                                        </div>
                                    </div>
                                    <h2 class="text-xl font-semibold text-white mb-1" id="h2-clt">Salário Bruto</h2>
                                    <p class="text-gray-500 text-xs">Valor registrado na carteira de trabalho.</p>
                                    
                                    <div class="relative mt-4 group-focus-within:scale-[1.02] transition-transform duration-300">
                                        <span class="absolute inset-y-0 left-0 flex items-center text-gray-500 text-2xl font-light">R$</span>
                                        <input name="clt_bruto" type="number" step="0.01" value="{{ clt_bruto|default_if_none:'' }}" placeholder="0,00" 
                                            class="w-full bg-transparent border-b-2 border-gray-700 text-white text-4xl font-bold py-2 pl-10 pr-2 focus:outline-none focus:border-blue-500 transition-colors placeholder-gray-700">
                                    </div>
                                </div>

                                <div class="mt-auto pt-4 border-t border-gray-800">
                                    <label class="block mb-2 text-xs font-medium text-gray-400 uppercase">Benefícios Extras (Opcional)</label>
                                    <div class="relative bg-gray-800 rounded-lg border border-gray-700 focus-within:border-blue-500/50 transition-colors">
                                        <span class="absolute inset-y-0 left-0 flex items-center pl-3 text-gray-500">R$</span>
                                        <input name="beneficios_extras" type="number" step="0.01" value="{{ beneficios_extras|default_if_none:'' }}" placeholder="VA, VT, Plano..." 
                                            class="w-full bg-transparent border-none rounded-lg py-2.5 pl-10 pr-4 text-gray-200 text-sm focus:ring-0">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 z-20 hidden md:flex items-center justify-center w-10 h-10 bg-gray-900 rounded-full border border-gray-700 shadow-xl text-gray-500 font-black text-xs italic">
                            VS
                        </div>

                        <div id="card-pj" class="group relative bg-gradient-to-b from-gray-800 to-gray-900 p-1 rounded-2xl transition-all duration-300 hover:shadow-yellow-500/10 hover:shadow-2xl">
                            <div class="absolute inset-0 bg-gradient-to-br from-yellow-500/20 to-transparent opacity-50 rounded-2xl group-hover:opacity-100 transition-opacity pointer-events-none"></div>
                            
                            <div class="relative h-full bg-gray-900/90 backdrop-blur-xl rounded-xl p-6 border border-yellow-500/30 flex flex-col">
                                <div class="mb-4">
                                    <div class="flex items-center justify-between mb-2">
                                        <label class="text-yellow-400 font-bold tracking-wide uppercase text-xs" id="h2-pj-label">PROPOSTA PJ</label>
                                        <div class="p-1.5 bg-yellow-500/10 rounded-md text-yellow-400">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                                        </div>
                                    </div>
                                    <h2 class="text-xl font-semibold text-white mb-1" id="h2-pj">Faturamento Bruto</h2>
                                    <p class="text-gray-500 text-xs">Valor total da nota fiscal mensal.</p>
                                    
                                    <div class="relative mt-4 group-focus-within:scale-[1.02] transition-transform duration-300">
                                        <span class="absolute inset-y-0 left-0 flex items-center text-gray-500 text-2xl font-light">R$</span>
                                        <input id="pj-revenue" name="pj_bruto" type="number" step="0.01" value="{{ pj_bruto|default_if_none:'' }}" placeholder="0,00" 
                                            class="w-full bg-transparent border-b-2 border-gray-700 text-white text-4xl font-bold py-2 pl-10 pr-2 focus:outline-none focus:border-yellow-500 transition-colors placeholder-gray-700">
                                    </div>
                                </div>

                                <div id="simples-banner" style="display: none;" class="mb-4 animate-fade-in">
                                    <div class="flex items-start gap-2 p-3 bg-gradient-to-r from-indigo-900/40 to-purple-900/40 border border-indigo-500/30 rounded-lg">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-indigo-400 mt-0.5 flex-shrink-0"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>
                                        <p class="text-[11px] text-indigo-200 leading-tight">
                                            <strong class="text-indigo-300 block mb-0.5">Estratégia Automática</strong>
                                            Calcularemos o melhor cenário entre <span class="text-white">Anexo III (Fator R)</span> e <span class="text-white">Anexo V</span>.
                                        </p>
                                    </div>
                                </div>

                                <div class="mt-auto pt-4 border-t border-gray-800 grid grid-cols-2 gap-3">
                                    <div>
                                        <label class="block mb-1 text-[10px] font-medium text-gray-400 uppercase">Custos Fixos</label>
                                        <div class="relative bg-gray-800 rounded-lg border border-gray-700 focus-within:border-yellow-500/50 transition-colors">
                                            <span class="absolute inset-y-0 left-0 flex items-center pl-2 text-gray-500 text-xs">R$</span>
                                            <input name="pj_costs" type="number" step="0.01" value="{{ pj_costs|default_if_none:'' }}" placeholder="0" 
                                                class="w-full bg-transparent border-none rounded-lg py-2 pl-7 pr-2 text-gray-200 text-sm focus:ring-0">
                                        </div>
                                    </div>
                                    
                                    <div id="simples-tax-rate-field" style="display: none;">
                                        <label class="block mb-1 text-[10px] font-medium text-gray-400 uppercase">Aliq. Simples (?)</label>
                                        <div class="relative bg-gray-800 rounded-lg border border-gray-700 focus-within:border-yellow-500/50 transition-colors">
                                            <input name="pj_tax_rate_override" type="number" step="0.01" value="{{ pj_tax_rate_override|default_if_none:'' }}" placeholder="Auto" 
                                                class="w-full bg-transparent border-none rounded-lg py-2 pl-3 pr-6 text-gray-200 text-sm focus:ring-0">
                                            <span class="absolute inset-y-0 right-0 flex items-center pr-2 text-gray-500 text-xs">%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="text-center mb-8">
                    <button type="submit" class="bg-teal-500 hover:bg-teal-400 text-gray-900 font-bold py-3 px-12 rounded-lg text-lg transition-transform hover:scale-105 shadow-lg shadow-teal-500/20">
                        Analisar Comparativo Fiscal
                    </button>
                </div>
            </form>
            
            {% if result %}
            <div id="results-section" class="bg-gray-800 rounded-2xl border border-gray-700 shadow-2xl animate-fade-in mt-8 overflow-hidden">
                
                <div class="p-8 bg-gradient-to-b from-gray-800 to-gray-900 border-b border-gray-700">
                    <h2 class="text-2xl font-bold text-center text-teal-400 mb-6 tracking-wide">Veredito da Inteligência Contábil</h2>
                    <div class="bg-gray-800/50 p-6 rounded-xl border border-gray-700 shadow-inner">
                        <p class="text-center text-gray-200 text-lg leading-relaxed font-light whitespace-pre-line">{{ result.analysis }}</p>
                    </div>
                </div>
                
                {% if result.benchmark %}
                    <div class="border-b border-gray-700 p-8 bg-gray-900/30">
                         <div class="max-w-2xl mx-auto">
                            <h3 class="text-sm font-semibold text-gray-400 uppercase tracking-wider mb-4 text-center">Termômetro de Mercado (Salário Bruto)</h3>
                            <div class="bg-gray-800 p-6 rounded-xl border border-gray-700/80">
                                {% include "benchmark_chart.html" %}
                            </div>
                         </div>
                    </div>
                {% endif %}

                <div class="p-6 grid grid-cols-1 md:grid-cols-3 gap-6 bg-gray-800">
                    <div class="group relative bg-gradient-to-br from-gray-800 to-gray-900 p-6 rounded-2xl border border-gray-700 hover:border-blue-500/50 transition-all duration-300">
                        <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-400"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path></svg>
                        </div>
                        <h3 class="text-xs font-bold text-blue-400 uppercase tracking-wider mb-2">Seu Valor Total (CLT)</h3>
                        <p class="text-3xl font-extrabold text-white">{{ result.clt_equivalent_formatted }}</p>
                        <p class="text-xs text-gray-500 mt-2 font-medium">Salário + Benefícios Mensalizados</p>
                    </div>

                    <div class="group relative bg-gradient-to-br from-gray-800 to-gray-900 p-6 rounded-2xl border border-gray-700 hover:border-yellow-500/50 transition-all duration-300">
                        <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-yellow-400"><path d="M20 7h-9"></path><path d="M14 17H5"></path><circle cx="17" cy="17" r="3"></circle><circle cx="7" cy="7" r="3"></circle></svg>
                        </div>
                        <h3 class="text-xs font-bold text-yellow-400 uppercase tracking-wider mb-2">Seu Líquido Real (PJ)</h3>
                        <p class="text-3xl font-extrabold text-white">{{ result.pj_real_formatted }}</p>
                        <p class="text-xs text-gray-500 mt-2 font-medium">Livre de impostos e provisões</p>
                    </div>

                    <div class="relative bg-gray-900 p-6 rounded-2xl border border-gray-800 flex flex-col justify-center items-center shadow-inner">
                        <h3 class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-1">Resultado Final</h3>
                        {% if result.diferenca > 0 %}
                            <p class="text-3xl font-black text-green-400 tracking-tight">+ {{ result.diferenca_formatted }}</p>
                            <div class="mt-2 px-3 py-1 bg-green-500/10 rounded-full border border-green-500/20">
                                <p class="text-xs text-green-400 font-bold uppercase">Vantagem PJ</p>
                            </div>
                        {% else %}
                            <p class="text-3xl font-black text-red-400 tracking-tight">- {{ result.diferenca_formatted }}</p>
                            <div class="mt-2 px-3 py-1 bg-red-500/10 rounded-full border border-red-500/20">
                                <p class="text-xs text-red-400 font-bold uppercase">Vantagem CLT</p>
                            </div>
                        {% endif %}
                    </div>
                </div>

                <div class="bg-gray-900/50 border-t border-gray-800 p-8">
                    <h3 class="text-xl font-bold text-center text-white mb-8 flex items-center justify-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-500"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg>
                        Memória de Cálculo (Líquido vs. Líquido)
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        
                        <div class="bg-gray-800 rounded-2xl border border-gray-700/50 overflow-hidden flex flex-col">
                            <div class="bg-gray-800/80 p-5 border-b border-gray-700/50 flex justify-between items-center">
                                <h4 class="text-lg font-bold text-blue-400">Pacote CLT</h4>
                                <span class="text-[10px] font-bold uppercase tracking-widest text-gray-500 bg-gray-900 px-2 py-1 rounded">Regime de Caixa</span>
                            </div>
                            
                            <div class="p-6 flex-grow space-y-3">
                                <div class="flex justify-between items-center text-sm group">
                                    <span class="text-gray-300">Salário Bruto</span>
                                    <span class="font-bold text-white">{{ result.clt_gross_f }}</span>
                                </div>
                                
                                <div class="border-t border-dashed border-gray-700 my-2"></div>
                                <p class="text-xs font-semibold text-rose-500 uppercase tracking-wide mb-1">Descontos Obrigatórios</p>

                                <div class="flex justify-between items-center text-sm group">
                                    <span class="text-gray-400">(-) INSS (Tabela 2024)</span>
                                    <span class="font-medium text-rose-400">- {{ result.clt_inss_f }}</span>
                                </div>
                                <div class="flex justify-between items-center text-sm group">
                                    <span class="text-gray-400">(-) IRRF (Simplificado)</span>
                                    <span class="font-medium text-rose-400">- {{ result.clt_irrf_f }}</span>
                                </div>

                                <div class="flex justify-between items-center text-sm pt-2 pb-1 border-t border-gray-700/50">
                                    <span class="text-xs uppercase font-bold text-gray-400">(=) Salário Líquido (na conta)</span>
                                    <span class="text-lg font-bold text-blue-300">{{ result.clt_net_f }}</span>
                                </div>

                                <div class="border-t border-dashed border-gray-700 my-2"></div>
                                <p class="text-xs font-semibold text-emerald-500 uppercase tracking-wide mb-1">Provisões (Líquidas) + Benefícios</p>
                                
                                <div class="flex justify-between items-center text-sm group">
                                    <span class="text-gray-400">(+) Benefícios Extras</span>
                                    <span class="font-medium text-emerald-400">+ {{ result.clt_benefits_f }}</span>
                                </div>
                                <div class="flex justify-between items-center text-sm group">
                                    <span class="text-gray-400">(+) Provisão 13º (Líquido)</span>
                                    <span class="font-medium text-emerald-400">+ {{ result.clt_thirteenth_f }}</span>
                                </div>
                                <div class="flex justify-between items-center text-sm group">
                                    <span class="text-gray-400">(+) Provisão Férias + 1/3 (Líquido)</span>
                                    <span class="font-medium text-emerald-400">+ {{ result.clt_vacation_f }}</span>
                                </div>
                                 <div class="flex justify-between items-center text-sm group">
                                    <span class="text-gray-400">(+) FGTS (Patrimônio)</span>
                                    <span class="font-medium text-emerald-400">+ {{ result.clt_fgts_f }}</span>
                                </div>
                            </div>
                            
                            <div class="bg-blue-900/20 p-5 border-t border-blue-500/20">
                                <div class="flex justify-between items-end">
                                    <span class="text-sm text-blue-200 font-medium">Valor Mensal Equivalente</span>
                                    <span class="text-2xl font-bold text-blue-400 leading-none">{{ result.clt_total_f }}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-gray-800 rounded-2xl border border-gray-700/50 overflow-hidden flex flex-col">
                            <div class="bg-gray-800/80 p-5 border-b border-gray-700/50 flex justify-between items-center">
                                <h4 class="text-lg font-bold text-yellow-400">Fluxo de Caixa PJ</h4>
                                <span class="text-[10px] font-bold text-gray-400 bg-gray-900 px-2 py-1 rounded text-right max-w-[160px]">{{ result.pj.strategy }}</span>
                            </div>
                        
                            <div class="p-6 flex-grow space-y-3">
                                <div class="flex justify-between items-center text-sm group">
                                    <span class="text-gray-300">Faturamento Bruto</span>
                                    <span class="font-bold text-white">{{ result.pj_revenue_f }}</span>
                                </div>

                                <div class="border-t border-dashed border-gray-700 my-2"></div>
                                <p class="text-xs font-semibold text-rose-500 uppercase tracking-wide mb-1">Custos e Impostos</p>

                                <div class="flex justify-between items-center text-sm group">
                                    <span class="text-gray-400">(-) Impostos (DAS {{ result.pj_tax_rate_f }})</span>
                                    <span class="font-medium text-rose-400">- {{ result.pj_tax_f }}</span>
                                </div>
                                <div class="flex justify-between items-center text-sm group">
                                    <span class="text-gray-400">(-) INSS Pró-labore</span>
                                    <span class="font-medium text-rose-400">- {{ result.pj_pro_labore_inss_f }}</span>
                                </div>
                                {% if result.pj.proLaboreIrrf > 0 %}
                                <div class="flex justify-between items-center text-sm group">
                                    <span class="text-gray-400">(-) IRRF Pró-labore</span>
                                    <span class="font-medium text-rose-400">- {{ result.pj_pro_labore_irrf_f }}</span>
                                </div>
                                {% endif %}
                                <div class="flex justify-between items-center text-sm group">
                                    <span class="text-gray-400">(-) Custos Fixos</span>
                                    <span class="font-medium text-rose-400">- {{ result.pj_costs_f }}</span>
                                </div>

                                <div class="flex justify-between items-center text-sm pt-2 pb-1 border-t border-gray-700/50">
                                    <span class="text-xs uppercase font-bold text-gray-400">(=) Caixa Líquido (antes prov.)</span>
                                    <span class="text-lg font-bold text-yellow-300">{{ result.pj_net_pre_provision_f }}</span>
                                </div>

                                <div class="border-t border-dashed border-gray-700 my-2"></div>
                                <p class="text-xs font-semibold text-amber-500 uppercase tracking-wide mb-1">Provisões de Segurança</p>
                                
                                <div class="flex justify-between items-center text-sm group">
                                    <span class="text-gray-400">(-) Reserva Férias/13º</span>
                                    <span class="font-medium text-amber-400">- {{ result.pj_provisions_f }}</span>
                                </div>
                            </div>
                            
                            <div class="bg-yellow-900/20 p-5 border-t border-yellow-500/20">
                                <div class="flex justify-between items-end">
                                    <span class="text-sm text-yellow-200 font-medium">Líquido Real Disponível</span>
                                    <span class="text-2xl font-bold text-yellow-400 leading-none">{{ result.pj_total_f }}</span>
                                </div>
                            </div>
                        </div>

                    </div>

                    <div class="mt-8 bg-teal-900/20 border border-teal-500/30 p-6 rounded-xl flex flex-col sm:flex-row items-center sm:items-start gap-4 text-center sm:text-left">
                        <div class="p-3 bg-teal-500/10 rounded-full text-teal-400 flex-shrink-0">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 5c-1.5 0-2.8 1.4-3 2-3.5-1.5-11-.3-11 5 0 1.8 0 3 2 4.5V20h4v-2h3v2h4v-4c1-.5 1.7-1 2-2.5 0-2-1.5-4-3-4Z"/><path d="M12 9h.01"/></svg>
                        </div>
                        <div>
                            <h4 class="text-lg font-bold text-teal-400">Dica de Investimento (FGTS)</h4>
                            <p class="text-gray-300 text-sm mt-1">
                                {% if result.clt.fgtsMonthly > 0 %}
                                    No regime CLT, sua empresa depositaria <strong class="text-white">{{ result.fgts_formatted }}</strong> por mês no seu FGTS. Se optar pelo PJ, considere investir esse valor mensalmente para garantir seu futuro.
                                {% else %}
                                    Como PJ, lembre-se de construir sua própria reserva de emergência e aposentadoria.
                                {% endif %}
                            </p>
                        </div>
                    </div>
                </div>

                <div class="bg-gray-900 border-t border-gray-800 p-8">
                    <h3 class="text-lg font-bold text-center text-white mb-6">Análise Qualitativa: Além dos Números</h3>
                    <div class="overflow-hidden rounded-xl border border-gray-700 shadow-sm">
                        <table class="w-full text-left border-collapse">
                            <thead class="bg-gray-800 text-gray-400 text-xs uppercase tracking-wider">
                                <tr>
                                    <th class="py-4 px-6 font-medium">Característica</th>
                                    <th class="py-4 px-6 text-center font-medium w-40">CLT</th>
                                    <th class="py-4 px-6 text-center font-medium w-40">PJ</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-800 bg-gray-900/50">
                                <tr class="hover:bg-gray-800/30 transition-colors">
                                    <td class="py-3 px-6 text-sm text-gray-300 font-medium">Flexibilidade de Horário/Local</td>
                                    <td class="py-3 px-6 text-center"><span class="text-red-400 text-xs font-bold">Baixa</span></td>
                                    <td class="py-3 px-6 text-center"><span class="text-green-400 text-xs font-bold">Alta</span></td>
                                </tr>
                                <tr class="hover:bg-gray-800/30 transition-colors">
                                    <td class="py-3 px-6 text-sm text-gray-300 font-medium">Estabilidade (Multa rescisória)</td>
                                    <td class="py-3 px-6 text-center"><span class="text-green-400 text-xs font-bold">Sim</span></td>
                                    <td class="py-3 px-6 text-center"><span class="text-red-400 text-xs font-bold">Não</span></td>
                                </tr>
                                <tr class="hover:bg-gray-800/30 transition-colors">
                                    <td class="py-3 px-6 text-sm text-gray-300 font-medium">Potencial de Ganhos (Multiclientes)</td>
                                    <td class="py-3 px-6 text-center"><span class="text-red-400 text-xs font-bold">Limitado</span></td>
                                    <td class="py-3 px-6 text-center"><span class="text-green-400 text-xs font-bold">Ilimitado</span></td>
                                </tr>
                                <tr class="hover:bg-gray-800/30 transition-colors">
                                    <td class="py-3 px-6 text-sm text-gray-300 font-medium">Burocracia (Notas, Contabilidade)</td>
                                    <td class="py-3 px-6 text-center"><span class="text-green-400 text-xs font-bold">Nenhuma</span></td>
                                    <td class="py-3 px-6 text-center"><span class="text-red-400 text-xs font-bold">Média</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="text-center p-12 bg-gray-800/30 rounded-2xl border-2 border-dashed border-gray-700 mt-8 animate-pulse">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="mx-auto text-gray-600 mb-4"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>
                <h3 class="text-lg font-medium text-gray-300">Aguardando dados</h3>
                <p class="text-gray-500 mt-2">Preencha os campos acima e clique em "Analisar Comparativo Fiscal".</p>
            </div>
            {% endif %}

        </div>
    </main>

    <footer class="bg-gray-900/80 border-t border-gray-800 mt-12 py-8">
        <div class="container mx-auto px-4 text-center">
            <div class="flex flex-col items-center justify-center space-y-4">
                <p class="text-gray-400 font-semibold text-lg">FIAP | Global Solution.</p>
                
                <div class="h-px w-16 bg-gray-700"></div>
                
                <div class="text-sm text-gray-500">
                    <p class="mb-2">Este projeto apoia os Objetivos de Desenvolvimento Sustentável da ONU:</p>
                    <div class="flex flex-wrap justify-center gap-3 mt-2">
                        <div class="flex items-center gap-2 px-3 py-1.5 bg-gray-800 rounded-lg border border-gray-700 hover:border-red-900/50 transition-colors">
                            <span class="font-black tean-red-700">ODS 8</span>
                            <span class="text-gray-300 text-xs font-medium">Trabalho Decente e Crescimento Econômico</span>
                        </div>
                        <div class="flex items-center gap-2 px-3 py-1.5 bg-gray-800 rounded-lg border border-gray-700 hover:border-red-900/50 transition-colors">
                            <span class="font-black text-tean-700">ODS 4</span>
                            <span class="text-gray-300 text-xs font-medium">Educação de Qualidade</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <p class="text-xs text-gray-600 mt-8">© 2025 TraduPay - Feito com transparência.</p>
        </div>
    </footer>

    <script>
        const btnClt = document.getElementById('btn-clt');
        const btnPj = document.getElementById('btn-pj');
        const inputMode = document.getElementById('work_mode_input');
        const cardClt = document.getElementById('card-clt'); 
        const cardPj = document.getElementById('card-pj');

        // Elementos para lógica MEI/Simples
        const pjRevenueInput = document.getElementById('pj-revenue');
        const simplesBanner = document.getElementById('simples-banner');
        const simplesTaxField = document.getElementById('simples-tax-rate-field');
        const meiLimit = {{ mei_limit|default:6750 }}; 

        function setWorkMode(mode) {
            inputMode.value = mode;
            
            const activeClass = 'bg-teal-500 text-gray-900 shadow-[0_0_20px_rgba(20,184,166,0.3)]';
            const inactiveClass = 'text-gray-400 hover:text-white hover:bg-gray-800';

            const h2CltLabel = document.getElementById('h2-clt-label');
            const h2PjLabel = document.getElementById('h2-pj-label');
            const h2Clt = document.getElementById('h2-clt');
            const h2Pj = document.getElementById('h2-pj');

            if (mode === 'clt') {
                btnClt.className = `relative z-10 px-8 py-3 rounded-lg text-sm font-bold transition-all duration-300 flex items-center gap-2 ${activeClass}`;
                btnPj.className = `relative z-10 px-8 py-3 rounded-lg text-sm font-bold transition-all duration-300 flex items-center gap-2 ${inactiveClass}`;
                cardClt.style.order = 1;
                cardPj.style.order = 2;
                h2CltLabel.innerText = 'CLT ATUAL';
                h2PjLabel.innerText = 'PROPOSTA PJ';
                h2Clt.innerText = 'Salário Bruto';
                h2Pj.innerText = 'Faturamento Bruto';
                
            } else {
                btnPj.className = `relative z-10 px-8 py-3 rounded-lg text-sm font-bold transition-all duration-300 flex items-center gap-2 ${activeClass}`;
                btnClt.className = `relative z-10 px-8 py-3 rounded-lg text-sm font-bold transition-all duration-300 flex items-center gap-2 ${inactiveClass}`;
                cardPj.style.order = 1;
                cardClt.style.order = 2;
                h2CltLabel.innerText = 'PROPOSTA CLT';
                h2PjLabel.innerText = 'PJ ATUAL';
                h2Clt.innerText = 'Salário Proposto';
                h2Pj.innerText = 'Faturamento Atual';
            }
        }

        function checkPjRevenue() {
            const revenue = parseFloat(pjRevenueInput.value) || 0;
            if (revenue > meiLimit) {
                simplesBanner.style.display = 'block';
                simplesTaxField.style.display = 'block';
            } else {
                simplesBanner.style.display = 'none';
                simplesTaxField.style.display = 'none';
            }
        }

        pjRevenueInput.addEventListener('input', checkPjRevenue);
        document.addEventListener('DOMContentLoaded', () => {
            setWorkMode(inputMode.value || 'clt');
            checkPjRevenue();
        });
    </script>
</body>
</html>